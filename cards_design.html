<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <main>
        <label for="cidade">Insira a Cidade:</label>
        <input id='cidade_0' type="text" placeholder="Insert city name">
        <button id="bt_0">Confirmar</button>
        <button id="bt_1" style="display:none;">Confirmar</button>
    </main>
<script>
        //efetuar a validação de valores incompletos
        vogais_acentuadas = ['á','à','ã','â','é','è','ê','í','ì','î','ó','ò','õ','ô','ú','ù','û']
        vogais_0 = ['a','e','i','o','u']
        id_city = 0
        uf_cidade = ''
        lista_city=[]
        lista_uf=[]
        input_0 = document.querySelector('#cidade_0')
        botao_0 = document.querySelector('#bt_0')
        botao_1 = document.querySelector('#bt_1')
        
        function replace_vogal(str){
            for(a=0;a<str.length;a++){
                for(b=0;b<vogais_acentuadas.length;b++){
                    if(str[a]===vogais_acentuadas[b]){
                        if(vogais_acentuadas[b]==vogais_acentuadas[0]||
                            vogais_acentuadas[b]==vogais_acentuadas[1]||
                            vogais_acentuadas[b]==vogais_acentuadas[2]||
                            vogais_acentuadas[b]==vogais_acentuadas[3]){
                            str=str.replace(str[a],vogais_0[0])};
                        if(vogais_acentuadas[b]==vogais_acentuadas[4]||
                            vogais_acentuadas[b]==vogais_acentuadas[5]||
                            vogais_acentuadas[b]==vogais_acentuadas[6]){
                            str=str.replace(str[a],vogais_0[1])};
                        if(vogais_acentuadas[b]==vogais_acentuadas[7]||
                            vogais_acentuadas[b]==vogais_acentuadas[8]||
                            vogais_acentuadas[b]==vogais_acentuadas[9]){
                            str=str.replace(str[a],vogais_0[2])};
                        if(vogais_acentuadas[b]==vogais_acentuadas[10]||
                            vogais_acentuadas[b]==vogais_acentuadas[11]||
                            vogais_acentuadas[b]==vogais_acentuadas[12]||
                            vogais_acentuadas[b]==vogais_acentuadas[13]){
                            str=str.replace(str[a],vogais_0[3])};
                        if(vogais_acentuadas[b]==vogais_acentuadas[14]||
                            vogais_acentuadas[b]==vogais_acentuadas[15]||
                            vogais_acentuadas[b]==vogais_acentuadas[16]){
                            str=str.replace(str[a],vogais_0[4])};
                    }
                }

            };return p=str
        }
        
        async function api_request(valor_input){
            resp = await fetch(`https://brasilapi.com.br/api/cptec/v1/clima/previsao/${valor_input}`);
            if(resp.status===200){
                cidade_inf=Promise.resolve(resp.json())
                cidade_inf.then(info=>{
                    console.log(info['clima'])
                })    
            }
        }
        function cidade_id(valor_input0, numerador){
            fetch(`https://brasilapi.com.br/api/cptec/v1/cidade/${valor_input0}`).then(arquivo=>{ return arquivo.json()})
            .then(valores=>{
                for(a=0;a<valores.length;a++){
                    if(valores[a]['nome']==lista_city[0]){lista_city.push(valores[a]['nome']),lista_uf.push(valores[a]['estado'])};
                    if(lista_city.length==0){lista_city.push(valores[a]['nome']),lista_uf.push(valores[a]['estado'])}
                }
                if(lista_city.length<=1){
                    uf_cidade = valores[0]['estado']
                    id_city = valores[0]['id']}
                else{
                    uf_cidade = valores[numerador]['estado']
                    id_city = valores[numerador]['id']}
                
            })
        }
        botao_0.addEventListener('click', function(){
            name_city = document.querySelector('#cidade_0').value
            
            setTimeout(function(){
                if(lista_city.length<=1){setTimeout(function(){console.log(uf_cidade)
                    api_request(id_city);lista_city.length=0;lista_uf.length=0
                },1000)}
                
                if(lista_city.length>1){
                        botao_0.style.display='none'
                        botao_1.style.display='block'
                        tag_select = document.createElement('select')
                    for(a=0;a<lista_city.length;a++){
                        tag_option = document.createElement('option')
                        tag_option.innerHTML=lista_city[a]+`(${lista_uf[a]})`
                        tag_select.appendChild(tag_option)
                        }
                    document.querySelector('main').replaceChild(tag_select, input_0)
                    botao_1.onclick=function(){console.log(cidade_id(name_city,tag_select.selectedIndex));
                        setTimeout(function(){
                            api_request(id_city);console.log(uf_cidade);document.querySelector('main').replaceChild(input_0,tag_select);
                            input_0.value='',botao_0.style.display='block';botao_1.style.display='none';lista_city.length=0;lista_uf.length=0    
                        },1000)}
            
            }},1000)
            
            
            cidade_id(name_city)
        })
        
</script>
</body>
</html>